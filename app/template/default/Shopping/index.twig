{#
This file is part of EC-CUBE

Copyright(c) EC-CUBE CO.,LTD. All Rights Reserved.

http://www.ec-cube.co.jp/

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.
#}
{% extends 'default_frame.twig' %}

{% form_theme form 'Form/form_div_layout.twig' %}

{% block javascript %}
    <script>
        $(function() {
            var $redirectCallback = function() {
                loadingOverlay();
                $('#shopping_order_redirect_to').val($(this).attr('data-path'));
                $('#shopping-form').attr('action', '{{ url("shopping_redirect_to") }}').submit();
                setTimeout(function () {
                    loadingOverlay("hide");
                }, 2000);
            };
            $('[data-trigger]').each(function() {
                $(this).on($(this).attr('data-trigger'), $redirectCallback);
            });

            {% if is_granted('ROLE_USER') == false %}
            var edit = $('.customer-edit');
            var hidden = $('.customer-in');
            var form = $('.customer-form');

            $('#customer').click(function() {
                $(edit).each(function(index) {
                    var name = $(this).text();
                    var input = $('<input id="edit' + index + '" type="text" />').val(name);
                    $(form[index]).empty().append(input);
                });

                $('.non-customer-display').hide();
                $('.non-customer-edit').show();
                $('.mod-button').show();
            });

            $('#customer-ok').click(function() {
                $(form).each(function(index) {
                    $(hidden[index]).val($(form[index]).children('input').val());
                });

                var postData = {};
                $(hidden).each(function() {
                    postData[$(this).attr('name')] = $(this).val();
                });

                loadingOverlay();

                $.ajax({
                    url: "{{ url('shopping_customer') }}",
                    type: 'POST',
                    data: postData,
                    dataType: 'json'
                }).done(function(data) {
                    if (data.status == 'OK') {
                        $(form).each(function(index) {
                            $(edit[index]).empty().text($(form[index]).children('input').val());
                            $(form[index]).empty();
                        });

                        // kana field
                        $(edit[2]).empty().text(data.kana01);
                        $(edit[3]).empty().text(data.kana02);
                        $('#customer-kana01').val(data.kana01);
                        $('#customer-kana02').val(data.kana02);
                    }
                }).fail(function() {
                    alert('更新に失敗しました。入力内容を確認してください。');
                }).always(function(data) {
                    // overlayを無効
                    loadingOverlay('hide');
                });

                $('.non-customer-display').show();
                $('.non-customer-edit').hide();
                $('.mod-button').hide();
            });

            $('#customer-cancel').click(function() {
                $('.non-customer-display').show();
                $('.non-customer-edit').hide();
                $('.mod-button').hide();
            });
            {% endif %}
        });
    </script>
{% endblock javascript %}

{% block main %}

<style type="text/css">
#page_shopping .ec-pageHeader{
    text-align: center
}
#page_shopping .ec-pageHeader h1{
    border-top:none;
    display: inline-block;

}
.ec-progress .ec-progress__number{
    color:#090000;
    background: white;
    border:solid 0.75px #706F6F;
    width:50px;
    height:50px;
    font-size:18px;
    line-height: 2.5;
}
.ec-progress .is-complete .ec-progress__number{
    background:#497E42;
    color:white;
}
.ec-progress .ec-progress__label,.ec-progress .is-complete .ec-progress__label{
    font-size:10px;
    font-weight:200;
}
.ec-progress .ec-progress__item:after{
    height:1px;
    top:25px;
}
.ec-orderAccount__account,.ec-orderDelivery__item,.ec-paymethod,.payment-attention,.ec-totalBox,#shopping_order_DonationPurpose,
.donate-checkbox,.one_stop-attention,.ec-input,#shopping_order_message
{
    margin-right:12px;
    margin-left:12px;
    width: calc(100% - 24px);
}
.ec-rectHeading h2{
    background: #32C855;
    color:white;
    text-align: center;
    border-radius: 8px;
}
.ec-rectHeading h3{
    background:rgba(132,218,118,0.13);
    margin-top:20px;
}
.ec-orderAccount__account p{
    font-size:1.4rem;
    color:#D43A2D;
    margin:20px 0;
}
.ec-orderAccount__account table th,.ec-cartRow__contentColumn table th{
    font-weight: normal;
    vertical-align: middle;
    font-size: 1.2rem;
}
.ec-orderAccount__account table th,.ec-orderAccount__account table td,
.ec-cartRow__contentColumn table th,.ec-cartRow__contentColumn table td
{
    padding-bottom:10px;
}
.ec-cartRole .ec-cartRole__cart{
    border:solid 1px #ACBEAE;
    border-radius:12px;
}
.ec-cartTable{
    border:none;
}
.ec-cartRow .ec-cartRow__contentColumn,.ec-cartRow .ec-cartRow__img,ec-cartRow__summary{
    display: block;
    width:100%;
}
.ec-cartRow .ec-cartRow__contentColumn{
    padding:10px;
}
.ec-cartRow .ec-cartRow__img{
    padding:0;
}
.ec-cartRole,.ec-orderRole{
    padding-left:5px;
    padding-right:5px;
}
.ec-cartRow__amountsettings,.ec-cartRow__amountUpDown{
    display: flex;
}
.ec-cartRow__amountUpDown{
    width:20%;
}
.ec-cartRow__amountsettings .ec-icon{
    width:20px;
}
.ec-cartRow .ec-cartRow__summary{
    font-weight: normal;
    font-size:1.4rem;
}
.arrow_next{
    width:100%;
}
.arrow_next img{
    display: block;
    max-width:100px;
    width:38%;
    margin:12px auto;
}
.ec-cartRole .ec-cartRole__actions{
    background:rgba(132,185,118,0.13);
    padding:14px;
}
.ec-cartRole .ec-cartRole__actions .ec-cartRole__total{
    text-align: left;
    font-weight: normal;
}
.ec-cartRole .ec-cartRole__actions .ec-cartRole__total span{
    color:#497E42;
    font-size:2rem;
    text-decoration: underline;
    font-weight:bold;
}
.ec-blockBtn--action{
    background-color: #497E42;
    border-radius: 5px;
    color:white;
    font-weight:normal;
    position: relative;
}
.ec-blockBtn--action:hover{
    background-color: #497E42;
    border-color: #497E42;
    opacity: 0.7;
}
.ec-blockBtn--action:after{
    content:"";
    background-image:url({{ asset('assets/img/action_btn.svg', 'user_data') }});
    background-repeat: no-repeat;
    background-size: contain;
    width:20px;
    height:20px;
    position: absolute;
    top:35.5%;
    right:15px;
}
.ec-blockBtn--cancel{
    background-color:white;
    color:#090000;
    border:solid 1px #497E42;
    border-radius: 5px;
    font-weight:normal;
    height:35px;
    line-height: 2.3;
    position: relative;
    margin-top:20px;
}
.ec-blockBtn--cancel:before{
    position: absolute;
    left:24%;
    content:"＜";
    margin-right:10px;
    font-weight:200;
}
.ec-cartRole .attention{
    margin:20px 5px;
    background: rgba(239,228,67,0.18);
    padding:12px;
}
.ec-cartRole .attention p:first-child{
    color:#FF00FF;
}
.ec-cartRole .attention p:first-child:before{
    content:"";
    display: inline-block;
    background-image:url({{ asset('assets/img/attention.svg', 'user_data') }});
    background-repeat: no-repeat;
    background-size: contain;
    width:20px;
    height: 20px;
    margin-right:5px;
    vertical-align: middle;
}
.ec-cartRole .attention p:last-child{
    color:#FF0000;
    margin-top:10px;
}
.ec-totalBox .ec-totalBox__spec,.ec-totalBox .ec-totalBox__total,.ec-totalBox .ec-totalBox__taxRate{
    display: none;
}
.ec-totalBox{
    background: rgba(0,132,60,0.06);
}
.mt-5rem{
    margin-bottom:5rem;
}
.ec-radio input[type="radio"]{
    width:20px;
}
.ec-paymethod > div{
    display: flex!important;
    align-items: baseline;
}
.payment-attention{
    font-size:1.4rem;
}
.payment-attention p{
    margin:10px 5px;
}
.payment-attention img{
    display: block;
    width:90%;
    margin:auto;
    max-width: 300px;
}
.ec-totalBox__paymentTotal p{
    text-align:left;
    font-size: 1.6rem;
    font-weight: normal;
}
.ec-totalBox__paymentTotal p span{
    font-size: 2.6rem;
    text-decoration: underline;
    color:#00843C;
}
.shopping-description,.shipping-info{
    font-size:1.4rem;
    width:90%;
    margin:20px auto;
}
.ec-select #shopping_order_DonationPurpose{
    height:40px;
}
.one_stop_head{
    background: rgba(132,218,118,0.13);
    padding: 8px 12px;
}
.one_stop_head h3{
    padding: 0;
    margin-top:0;
    background: none;
}
.one_stop_head p{
    text-align: right;
}
.one_stop_head p a{
    font-size: 1.4rem;
    color: #2C76B7;
    text-decoration: underline;
}
.one_stop_head p a:before{
    content: "";
    display: inline-block;
    width: 9px;
    background: url({{ asset('assets/img/onestop.svg', 'user_data') }});
    height: 10px;
    background-repeat: no-repeat;
    background-size: contain;
    margin-right: 5px;
}
.one_stop-attention{
    background: rgba(239,228,67,0.18);
    padding:1.8rem;
}
.one_stop-attention label{
    color:#497E42;
    font-size:1.2rem;
    font-weight: bold;
}
.one_stop-attention label:not(:first-child){
    margin-top:1.5rem;
}
.one_stop-attention p{
    font-size:1rem;
}
.one_stop-attention p span{
    font-weight: bold;
    font-size:1.2rem;
}
.ec-orderDelivery__title{
    display: none;
}
.ec-orderDelivery .ec-orderDelivery__change,.customerinfo-change_btn{
    position: relative;
    display: block;
    width: 100%;
    margin-top:20px;
}
.customerinfo-change_btn{
    border: 1px solid #ccc;
    padding:10px 16px;
    text-align: center;
}
.ec-orderAccount__account .customerinfo-change_btn p{
    color: #525263;
    margin:0;
}
.ec-orderDelivery .ec-orderDelivery__change button{
    width: 100%;
    background: white;
}
.donate-checkbox{
    display: flex;
    align-items: center;
    border: solid 1px #000;
    padding:10px;
    margin-bottom:30px;
}
.donate-checkbox input{
    height: 15px;
    width: 15px;
    margin-bottom:0;
    margin-right:10px;
}
.donate-checkbox p{
    width:calc(100% - 25px);
}
.donate-checkbox p label{
    width: 100%;
}
.ec-cartRow__img {
    padding: 0;
    margin-bottom: 10px;
}
.ec-cartRow__name{
    margin-bottom: 10px;
}
.ec-orderDelivery__actions,.ec-orderDelivery__address,.ec-orderDelivery__edit{
    display: none;
}

.ec-orderRole .ec-borderedList{
    border-top:none;
}
.ec-cartRow__contentColumn,.ec-borderedList li{
    border:solid 1px #72913D;
    border-radius: 8px;
    padding: 20px 10px;
    max-width: 680px;
    margin-bottom:2rem;
}

@media only screen and (min-width: 768px){
.ec-select #shopping_order_DonationPurpose{
    margin-left: calc(50% - 300px);
    margin-right: calc(50% - 300px);
    margin-bottom:30px;
}
.ec-orderDelivery__item-wrap{
    display: flex;
    flex-wrap:wrap;
    justify-content:space-between;
}
.ec-orderDelivery__item-wrap .ec-orderDelivery__item-block{
    width: 49%;
}
.ec-orderRole .ec-orderRole__summary {
    margin-top:0!important;
    width:100%;
}
.ec-orderRole .ec-orderRole__detail{
    width: 100%;
}
.ec-borderedList li{
    width:46%;
    margin-left:1rem;
    margin-right:1rem;
    float:left;
}
.ec-orderDelivery .shipping-info{
    clear: both;
}
.ec-orderRole{
    display: block;
    max-width: 750px;
    margin:auto;
}
.ec-totalBox__btn{
    max-width:500px;
    margin:30px auto;
}
.ec-orderAccount__account,.ec-orderDelivery__item,.ec-paymethod,.payment-attention,.ec-totalBox,#shopping_order_DonationPurpose,
.donate-checkbox,.one_stop-attention,.ec-input,#shopping_order_message
{
    margin-right:auto;
    margin-left:auto;
    width: calc(100% - 24px);
    max-width: 600px;
}
.ec-orderDelivery__item{
    max-width: 640px;
}
.shopping-description, .shipping-info{
    margin-right:auto;
    margin-left:auto;
    max-width: 600px;
}
}
</style>

<main id="about">
<div class="container">

    <div class="ec-role">
        <div class="ec-pageHeader">
            <h1>申込手続き</h1>
        </div>
    </div>

    <div class="ec-cartRole">
        <div class="ec-cartRole__progress">
            <ul class="ec-progress">
                {% set step = 1 %}
                <li class="ec-progress__item">
                    <div class="ec-progress__number">{{ step }}{% set step = step + 1 %}
                    </div>
                    <div class="ec-progress__label">選択したお礼の品
                    </div>
                </li>
                {% if is_granted('ROLE_USER') == false %}
                    <li class="ec-progress__item">
                        <div class="ec-progress__number">{{ step }}{% set step = step + 1 %}
                        </div>
                        <div class="ec-progress__label">申込手続き
                        </div>
                    </li>
                {% endif %}
                <li class="ec-progress__item is-complete">
                    <div class="ec-progress__number">{{ step }}{% set step = step + 1 %}
                    </div>
                    <div class="ec-progress__label">申込手続き
                    </div>
                </li>
                <li class="ec-progress__item">
                    <div class="ec-progress__number">{{ step }}{% set step = step + 1 %}
                    </div>
                    <div class="ec-progress__label">入力確認
                    </div>
                </li>
                <li class="ec-progress__item">
                    <div class="ec-progress__number">{{ step }}{% set step = step + 1 %}
                    </div>
                    <div class="ec-progress__label">完了
                    </div>
                </li>
            </ul>
        </div>

        <!-- アラートメッセージ -->
        {{ include('Shopping/alert.twig') }}
    </div>

    <form id="shopping-form" method="post" action="{{ url('shopping_confirm') }}">
        {{ form_widget(form._token) }}
        {{ form_widget(form.redirect_to) }}
        <div class="ec-orderRole">
            <div class="ec-orderRole__detail">
                <div class="ec-orderAccount">
                    <div class="ec-rectHeading">
                        <h2>お申込者情報</h2>
                    </div>
                    {% if is_granted('ROLE_USER') == false %}
                        <div class="ec-orderAccount__change non-customer-display">
                            <button id="customer" class="ec-inlineBtn" type="button">{{ 'common.change'|trans }}</button>
                        </div>
                    {% endif %}
                    <div class="ec-orderAccount__account non-customer-display">
                        <p>『控除対象者』の情報を正しく入力して下さい。 <br>※寄付申込完了後に変更はできません。</p>
                        <table>
                            <tr>
                                <th>お名前︓</th>
                                <td>{{ Order.name01 }}　{{ Order.name02 }}様</td>
                            </tr>
                            <tr>
                                <th>お名前カナ︓</th>
                                <td>{{ Order.kana01 }}　{{ Order.kana02 }}様</td>
                            </tr>
                            <tr>
                                <th>郵便番号︓</th>
                                <td>〒{{ Order.postal_code }}</td>
                            </tr>
                            <tr>
                                <th>住所︓</th>
                                <td>{{ Order.pref }}{{ Order.addr01 }}<br>{{ Order.addr02 }}</td>
                            </tr>
                            <tr>
                                <th>電話番号︓</th>
                                <td>{{ Order.phone_number }}</td>
                            </tr>
                            <tr>
                                <th>メールアドレス︓</th>
                                <td>{{ Order.email }}</td>
                            </tr>
                            <tr>
                                <th>生年月日︓</th>
                                <td>{{ Order.birth|date('Y年m月d日', 'asia/tokyo') }}</td>
                            </tr>

                        </table>
                        <a href="{{ url('mypage_change') }}" class="customerinfo-change_btn"><p>お申込者情報を修正する</p></a>
                    </div>
                    {% if is_granted('ROLE_USER') == false %}
                        <div class="ec-borderedDefs  non-customer-edit" style="display:none;">
                            <dl>
                                <dt>
                                    <label class="ec-label required">{{ 'common.name'|trans }}</label>
                                    <span class="ec-required">{{ 'common.required'|trans }}</span>
                                </dt>
                                <dd>
                                    <div class="ec-halfInput">
                                        <span class="customer-form customer-name01"></span>
                                        <span class="customer-form customer-name02"></span>
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label class="ec-label required">{{ 'common.kana'|trans }}</label>
                                    <span class="ec-required">{{ 'common.required'|trans }}</span>
                                </dt>
                                <dd>
                                    <div class="ec-halfInput">
                                        <span class="customer-form customer-kana01"></span>
                                        <span class="customer-form customer-kana02"></span>
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label class="ec-label" for="nonmember_company_name">{{ 'common.company_name'|trans }}</label>
                                </dt>
                                <dd>
                                    <div class="ec-halfInput">
                                        <span class="customer-form customer-company_name"></span>
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label class="ec-label required">{{ 'common.address'|trans }}</label>
                                    <span class="ec-required">{{ 'common.required'|trans }}</span>
                                </dt>
                                <dd>
                                    <div class="ec-zipInput">
                                        <span>{{ 'common.postal_symbol'|trans }}</span>
                                        <span class="customer-form customer-postal_code"></span>
                                        <div class="ec-zipInputHelp">
                                            <div class="ec-zipInputHelp__icon">
                                                <div class="ec-icon">
                                                    <img src="{{ asset('assets/icon/question-white.svg') }}" alt="">
                                                </div>
                                            </div>
                                            <a href="https://www.post.japanpost.jp/zipcode/" target="_blank">
                                                <span>{{ 'common.search_postal_code'|trans }}</span>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="ec-select">
                                        <span class="customer-form customer-address_pref"></span>
                                    </div>
                                    <div class="ec-input">
                                        <span class="customer-form customer-address_addr01"></span>
                                    </div>
                                    <div class="ec-input">
                                        <span class="customer-form customer-address_addr02"></span>
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label class="ec-label required" for="nonmember_phone_number">{{ 'common.phone_number'|trans }}</label>
                                    <span class="ec-required">{{ 'common.required'|trans }}</span>
                                </dt>
                                <dd>
                                    <div class="ec-telInput">
                                        <span class="customer-form customer-phone_number"></span>
                                    </div>
                                </dd>
                            </dl>
                            <dl>
                                <dt>
                                    <label class="ec-label required">{{ 'common.mail_address'|trans }}</label>
                                    <span class="ec-required">{{ 'common.required'|trans }}</span>
                                </dt>
                                <dd>
                                    <div class="ec-input">
                                        <span class="customer-form customer-email"></span>
                                    </div>
                                </dd>
                            </dl>
                        </div>
                        <div class="mod-button" style="display:none;">
                            <span id="customer-ok"><button type="button" class="ec-inlineBtn">{{ 'common.ok'|trans }}</button></span>
                            <span id="customer-cancel"><button type="button" class="ec-inlineBtn">{{ 'common.cancel'|trans }}</button></span>
                        </div>
                        <input type="hidden" id="customer-name01" class="customer-in" name="customer_name01" value="{{ Order.name01 }}">
                        <input type="hidden" id="customer-name02" class="customer-in" name="customer_name02" value="{{ Order.name02 }}">
                        <input type="hidden" id="customer-kana01" class="customer-in" name="customer_kana01" value="{{ Order.kana01 }}">
                        <input type="hidden" id="customer-kana02" class="customer-in" name="customer_kana02" value="{{ Order.kana02 }}">
                        <input type="hidden" id="customer-company-name" class="customer-in" name="customer_company_name" value="{{ Order.companyName }}">
                        <input type="hidden" id="customer-postal_code" class="customer-in" name="customer_postal_code" value="{{ Order.postal_code }}">
                        <input type="hidden" id="customer-pref" class="customer-in" name="customer_pref" value="{{ Order.pref }}">
                        <input type="hidden" id="customer-addr01" class="customer-in" name="customer_addr01" value="{{ Order.addr01 }}">
                        <input type="hidden" id="customer-addr02" class="customer-in" name="customer_addr02" value="{{ Order.addr02 }}">
                        <input type="hidden" id="customer-phone_number" class="customer-in" name="customer_phone_number" value="{{ Order.phone_number }}">
                        <input type="hidden" id="customer-email" class="customer-in" name="customer_email" value="{{ Order.email }}">
                    {% endif %}
                </div>
                <div class="ec-orderDelivery">
                    <div class="ec-rectHeading">
                        <h2>お届け先情報</h2>
                    </div>
                    <p class="shipping-info">お届け先の郵便番号や住所・お名前に誤りがあると配送の遅れにつながります。 今一度ご確認ください。</p>
                    {% for shipping in Order.shippings %}
                        {% set idx = loop.index0 %}
                        {% set isShowReducedTaxMess = false %}
                        <div class="ec-orderDelivery__title">{{ 'front.shopping.delivery_to'|trans }}{% if Order.multiple %}({{ loop.index }}){% endif %}
                        </div>
                        <div class="ec-orderDelivery__item">
                            <ul class="ec-borderedList">
                                {% for orderItem in shipping.productOrderItems %}
                                {% set ProductClass = orderItem.ProductClass %}
                                {% set Product = ProductClass.Product %}
                                <li class="ec-cartRow__contentColumn">
                                    <div class="ec-cartRow__img">
                                        <a target="_blank" href="{{ url('product_detail', {id : Product.id} ) }}">
                                            <img src="{{ asset(Product.main_list_image|no_image_product, 's3_image') }}" alt="{{ Product.name }}"/>
                                        </a>
                                    </div>
                                    <div class="ec-cartRow__summary">
                                        <div class="ec-cartRow__name">
                                            <a target="_blank" href="{{ url('product_detail', {id : Product.id} ) }}">{{ Product.name }}</a>
                                            {% if ProductClass.ClassCategory1 and ProductClass.ClassCategory1.id %}
                                                <br>{{ ProductClass.ClassCategory1.ClassName.name }}：{{ ProductClass.ClassCategory1 }}
                                            {% endif %}
                                            {% if ProductClass.ClassCategory2 and ProductClass.ClassCategory2.id %}
                                                <br>{{ ProductClass.ClassCategory2.ClassName.name }}：{{ ProductClass.ClassCategory2 }}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <table>
                                        <tr>
                                            <th>数量︓</th>
                                            <td>{{ orderItem.quantity|number_format }}</td>
                                        </tr>
                                        {% if Product.room_temperature_delivery == '1' %}
                                        <tr>
                                            <th>配送方法︓</th>
                                            <td>常温配送</td>
                                        </tr>
                                        {% elseif  Product.refrigerated_delivery == '1' %}
                                        <tr>
                                            <th>配送方法︓</th>
                                            <td>冷蔵配送</td>
                                        </tr>
                                        {% elseif  Product.refrigerated_delivery == '1' %}
                                        <tr>
                                            <th>配送方法︓</th>
                                            <td>冷凍配送</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <th>お名前︓</th>
                                            <td>{{ shipping.name01 }} {{ shipping.name02 }}様</td>
                                        </tr>
                                        <tr>
                                            <th>お名前カナ︓</th>
                                            <td>{{ shipping.kana01 }} {{ shipping.kana02 }}様</td>
                                        </tr>
                                        <tr>
                                            <th>郵便番号︓</th>
                                            <td>〒{{ shipping.postal_code }}</td>
                                        </tr>
                                        <tr>
                                            <th>住所︓</th>
                                            <td>
                                            {{ shipping.pref }}{{ shipping.addr01 }}<br>{{ shipping.addr02 }}
                                            </td>
                                        </tr>
                                        <tr>
                                            <th>電話番号︓</th>
                                            <td>{{ shipping.phone_number }}</td>
                                        </tr>
                                    </table>
                                    <div class="ec-orderDelivery__change">
                                        {% if is_granted('ROLE_USER') %}
                                            <button class="ec-inlineBtn" data-id="{{ shipping.id }}" data-trigger="click" data-path="{{ path('shopping_shipping_multiple') }}">お届け先を変更する</button>
                                        {% else %}
                                            <button class="ec-inlineBtn" data-id="{{ shipping.id }}" data-trigger="click" data-path="{{ path('shopping_shipping_multiple') }}">お届け先を変更する</button>
                                        {% endif %}
                                    </div>
                                </li>
                                {% endfor %}
                            </ul>
                            <p>{{ isShowReducedTaxMess ? 'common.reduced_tax_rate_messeage'|trans }}</p>
                        </div>
                        <div class="ec-orderDelivery__address">
                            <p>{{ 'common.name.prefix'|trans }}{{ shipping.name01 }} {{ shipping.name02 }} ({{ shipping.kana01 }} {{ shipping.kana02 }}){{ 'common.name.suffix'|trans }}</p>
                            <p>{{ 'common.postal_symbol'|trans }}{{ shipping.postal_code }} {{ shipping.pref }}{{ shipping.addr01 }}{{ shipping.addr02 }}</p>
                            <p>{{ shipping.phone_number }}</p>
                        </div>
                        <div class="ec-orderDelivery__actions">
                            <div class="ec-selects">
                                <div class="ec-select">
                                    <label>{{ 'front.shopping.delivery_provider'|trans }}</label>
                                    {{ form_widget(form.Shippings[idx].Delivery, { 'attr': { 'class': 'form-control', 'data-trigger': 'change' }}) }}
                                    {{ form_errors(form.Shippings[idx].Delivery) }}
                                </div>
                                <div class="ec-select ec-select__delivery">
                                    <label>{{ 'front.shopping.delivery_date'|trans }}</label>
                                    {{ form_widget(form.Shippings[idx].shipping_delivery_date, {'attr': {'class': 'form-control'}}) }}
                                    {{ form_errors(form.Shippings[idx].shipping_delivery_date) }}
                                </div>
                                <div class="ec-select ec-select__time">
                                    <label>{{ 'front.shopping.delivery_time'|trans }}</label>
                                    {{ form_widget(form.Shippings[idx].DeliveryTime, {'attr': {'class': 'form-control'}}) }}
                                    {{ form_errors(form.Shippings[idx].DeliveryTime) }}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    <div class="ec-orderDelivery__edit">
                        <button type="button" class="ec-inlineBtn" data-trigger="click" data-path="{{ path('shopping_shipping_multiple') }}">{{ 'front.shopping.to_multiple'|trans }}</button>
                    </div>
                    <p class="shipping-info">寄附証明書などの書類はお申込者のご住所にお送りいたします。</p>
                </div>
                <div class="ec-orderRole__summary">
                    <div class="ec-rectHeading">
                        <h2>お支払い方法と金額</h2>
                    </div>
                    <div class="ec-rectHeading">
                        <h3>お支払い方法</h3>
                    </div>
                    <div class="ec-radio ec-paymethod">
                        {% for key, child in form.Payment %}
                            <div style="display: block;">
                                {% set Payment = form.Payment.vars.choices[key].data %}
                                {{ form_widget(child, { 'attr': { 'data-trigger': 'change' }}) }}
                                {% if Payment.payment_image is not null %}
                                    <p><img src="{{ asset(Payment.payment_image, 'save_image') }}"></p>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                    <div class="ec-input {{ has_errors(form.Payment) ? ' error' }}">{{ form_errors(form.Payment) }}</div>
                    {% if BaseInfo.isOptionPoint and Order.Customer is not null %}
                        <div class="ec-orderPayment">
                            <div class="ec-rectHeading">
                                <h2>{{ 'front.shopping.point_info'|trans }}</h2>
                            </div>
                            <div class="ec-input {{ has_errors(form.use_point) ? ' error' }}">
                                <p>{{ 'front.shopping.available_point'|trans({ '%point%': Order.Customer.Point|number_format }) }}</p>
                                {{ form_widget(form.use_point, { 'attr': { 'type': 'text', 'class': 'form-control', 'data-trigger': 'change' }}) }}
                                {{ form_errors(form.use_point) }}
                            </div>
                        </div>
                    {% endif %}
                    <div class="payment-attention">
                        <p>VISA/MASTER/JCB/AMEX/Diner
                        のクレジットカードでお支払い頂け
                        ます。必ずお申込者ご本人様名義の
                        クレジットカードにてお申込みいた
                        だきますようお願いいたします。  </p>
                        <img src="{{ asset('assets/img/credit_img.png', 'user_data') }}" />
                    </div>
                    <div class="ec-rectHeading">
                        <h3>寄付金額</h3>
                    </div>
                    <div class="ec-totalBox mt-5rem">
                        <dl class="ec-totalBox__spec">
                            <dt>{{ 'common.subtotal'|trans }}</dt>
                            <dd class="ec-totalBox__specTotal">{{ Order.subtotal|price }}</dd>
                        </dl>
                        <dl class="ec-totalBox__spec">
                            <dt>{{ 'common.charge'|trans }}</dt>
                            <dd>{{ Order.charge|price }}</dd>
                        </dl>
                        <dl class="ec-totalBox__spec">
                            <dt>{{ 'common.delivery_fee'|trans }}</dt>
                            <dd>{{ Order.deliveryFeeTotal|price }}</dd>
                        </dl>
                        {% if Order.taxable_discount < 0 %}
                            <dl class="ec-totalBox__spec">
                                <dt>{{ 'common.discount'|trans }}</dt>
                                <dd>{{ Order.taxable_discount|price }}</dd>
                            </dl>
                        {% endif %}
                        <div class="ec-totalBox__total">{{ 'common.total'|trans }}<span class="ec-totalBox__price">{{ Order.taxable_total|price }}</span><span class="ec-totalBox__taxLabel">{{ 'common.tax_include'|trans }}</span></div>
                        {% for rate, total in Order.taxable_total_by_tax_rate %}
                            <dl class="ec-totalBox__taxRate">
                                <dt>{{ 'common.tax_rate_target'|trans({ '%rate%': rate }) }}</dt>
                                <dd>{{ total|price }}</dd>
                            </dl>
                        {% endfor %}
                        {% for item in Order.tax_free_discount_items %}
                            {% if loop.first %}<div class="ec-totalBox__total"></div>{% endif %}
                            <dl class="ec-totalBox__spec">
                                <dt>{{ item.product_name }}</dt>
                                <dd>{{ item.total_price|price }}</dd>
                            </dl>
                        {% endfor %}
                        <div class="ec-totalBox__paymentTotal">
                            <p>現在のお礼の品を希望する場合、<br> <span>{{ Order.payment_total|number_format }}円</span>の寄付が必要です。</p>
                            </div>
                    </div>
                </div>
                <div class="ec-orderConfirm">
                    <div class="ec-rectHeading">
                        <h2>寄付情報</h2>
                    </div>
                    <div class="ec-select">
                        <div class="ec-rectHeading">
                            <h3>寄付金の使い道</h3>
                        </div>
                        <p class="shopping-description">紋別市ではいただいた寄付金の使い道を指定することが可能です。ご指定の使い道を選択してください。</p>
                        {{ form_widget(form.DonationPurpose, { 'attr': { 'class': 'form-control' }}) }}
                        {{ form_errors(form.DonationPurpose) }}
                    </div>


                    <div class="ec-checkbox">
                        <div class="ec-rectHeading one_stop_head">
                            <h3>ワンストップ特例制度</h3>
                            <p><a href="">ワンストップ特例制度とは？</a></p>
                        </div>
                        <p class="shopping-description">「寄附金税額控除に係る申告特例（ワンストップ特例）」の申請書をご要望の方は、 チェックを入れてください。</p>
                        <div class="donate-checkbox">
                            {{ form_widget(form.one_stop) }}
                            <p><label for="shopping_order_one_stop">寄付金税額控除に係る申告特例申請書を要望する</label></p>
                        </div>
                        {{ form_errors(form.one_stop) }}
                        <div class="one_stop-attention">
                            <label>注意事項</label>
                            <p>
                                <span class="fw-b">こちらにチェックをつけただけでは控除の対象となりません</span><br>
                                後日送付する「寄付金税額控除に係る申告特例申請書」に記入・捺印いただき、紋別市までご返送頂く必要があります。
                            </p>
                            <label>次の条件を満たしている必要があります</label>
                            <p>
                                <span class="fw-b">１：もともと確定申告をする必要のない給与所得者等であること。</span><br>
                                ※年収2,0000万円以上の所得者や、医療費控除のために確定申告が必要な場合は確定申告で寄付金控除を申請してください
                            </p>
                            <p>
                                <span class="fw-b">２：1年間の寄付先が5自治体以下であること。</span><br>
                                ※1つの自治体に複数寄付しても1カウントとなります。
                            </p>
                        </div>
                        <p class="shopping-description">ふるさと納税の仕組みと手続きについては<a href="">こちら</a></p>
                    </div>
                    <div class="ec-rectHeading">
                        <h3>紋別市への応援メッセージ</h3>
                    </div>
                    <div class="ec-input">
                        {{ form_widget(form.cheer_message, {'attr': {'class': 'form-control', 'placeholder': 'front.shopping.cheer_message_placeholder'|trans, 'rows': '6'}}) }}
                        {{ form_errors(form.cheer_message) }}
                    </div>
                    <div class="ec-checkbox">
                        <p class="shopping-description">このコメント欄は、メッセージ・ご意見専用です。お礼品や書類の配送、各種変更等に関するご希望・ご連絡をご記入いただいても対応できかねますので、ご了承ください。<br><br>
                        メッセージを紋別市ふるさと納税サイトや広報などでご紹介して良い場合は、チェックを入れてください。</p>
                        <div class="donate-checkbox">
                            {{ form_widget(form.cheer_message_publish) }}
                            <p><label for="shopping_order_cheer_message_publish">応援メッセージを公表して良い</label></p>
                        </div>
                        {{ form_errors(form.cheer_message_publish) }}
                    </div>

                    <div class="ec-checkbox" style="display: none;">
                        <label>{{ 'front.shopping.document_send_difference'|trans }}</label>
                        {{ form_widget(form.document_send_difference) }}
                        {{ form_errors(form.document_send_difference) }}
                    </div>
                    <div class="ec-rectHeading">
                        <h3>寄付者名の公表</h3>
                        <p class="shopping-description">ホームページなどへ寄付者名を公表して良い場合は、チェックを入れてください。</p>
                        <div class="donate-checkbox">
                            {{ form_widget(form.name_announce) }}
                            <p><label for="shopping_order_name_announce">寄付者名を公表して良い</label></p>
                        </div>
                        {{ form_errors(form.name_announce) }}
                    </div>
                    <div class="ec-rectHeading">
                        <h3>備考欄</h3>
                    </div>
                    <div class="ec-input">
                        <p class="shopping-description">お礼の品のお届けについてご希望がございましたらご記入下さい。内容によっては、ご希望に添えない場合がございます。また、着日の指定は承ることができません。あらかじめご承知おきください。</p>
                        {{ form_widget(form.offer_memo, {'attr': {'class': 'form-control', 'placeholder': 'front.shopping.message_placeholder'|trans, 'rows': '6'}}) }}
                        {{ form_errors(form.offer_memo) }}
                    </div>
                    <p class="shipping-info">上記内容を確認し、よろしければチェックを入れて決済画面に進んでください。</p>
                    <div class="donate-checkbox">
                        {{ form_widget(form.agreement) }}
                        <p><label for="shopping_order_agreement">上記事項および利用規約に同意の上申し込みます。</label></p>
                    </div>
                    {{ form_errors(form.agreement) }}
                </div>
            </div>
            <div class="ec-totalBox__btn">
                <button type="submit" class="ec-blockBtn--action">確認画面へ進む</button>
                <a href="{{ url("cart") }}" class="ec-blockBtn--cancel">前の画面に戻る</a>
            </div>
        </div>
    </form>


</div>
</main>
{% endblock %}